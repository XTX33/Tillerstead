{%- comment -%}
Loading Screen Component
Displays a branded loading screen with animation that fades out when page is loaded.
Uses theme tokens for consistent styling.
{%- endcomment -%}

<div id="ts-loading-screen" class="ts-loading-screen" aria-hidden="true">
  <div class="ts-loading-content">
    <div class="ts-loading-logo">
      <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="Tillerstead Loading">
        <!-- Sacred Tile Pattern Icon -->
        <circle cx="40" cy="40" r="38" stroke="var(--color-primary)" stroke-width="2" fill="none" opacity="0.3"/>
        <circle cx="40" cy="40" r="30" stroke="var(--color-primary)" stroke-width="2" fill="none" opacity="0.5"/>
        <circle cx="40" cy="40" r="22" stroke="var(--color-primary)" stroke-width="2" fill="none" opacity="0.7"/>
        <path d="M40 18 L40 62 M18 40 L62 40" stroke="var(--color-primary)" stroke-width="2" opacity="0.6"/>
        <path d="M25.86 25.86 L54.14 54.14 M54.14 25.86 L25.86 54.14" stroke="var(--color-accent)" stroke-width="2" opacity="0.5"/>
        <!-- Center dot -->
        <circle cx="40" cy="40" r="4" fill="var(--color-primary)"/>
      </svg>
    </div>
    <h1 class="ts-loading-title">Tillerstead</h1>
    <p class="ts-loading-subtitle">Property Care, Done Right</p>
    <div class="ts-loading-spinner">
      <div class="ts-spinner-bar"></div>
    </div>
  </div>
</div>

<style>
/* Loading Screen Styles - Using Theme Tokens */
.ts-loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--color-bg);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  transition: opacity var(--transition-slow), visibility var(--transition-slow);
}

.ts-loading-screen.ts-loaded {
  opacity: 0;
  visibility: hidden;
}

.ts-loading-content {
  text-align: center;
  max-width: 400px;
  padding: var(--space-6);
}

.ts-loading-logo {
  margin-bottom: var(--space-5);
  animation: ts-pulse 2s ease-in-out infinite;
}

.ts-loading-logo svg {
  margin: 0 auto;
  display: block;
}

.ts-loading-title {
  font-size: var(--heading-2);
  font-weight: 700;
  color: var(--color-heading);
  margin: 0 0 var(--space-2);
  letter-spacing: 0.05em;
  text-transform: uppercase;
}

.ts-loading-subtitle {
  font-size: var(--font-size-lg);
  color: var(--color-text-muted);
  margin: 0 0 var(--space-6);
  font-weight: 400;
}

.ts-loading-spinner {
  width: 100%;
  max-width: 200px;
  height: 4px;
  background: var(--color-surface-elevated);
  border-radius: var(--radius-pill);
  overflow: hidden;
  margin: 0 auto;
}

.ts-spinner-bar {
  width: 40%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    var(--color-primary),
    var(--color-primary-strong),
    transparent
  );
  animation: ts-loading-slide 1.5s ease-in-out infinite;
  border-radius: var(--radius-pill);
}

/* Animations */
@keyframes ts-pulse {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.8;
    transform: scale(1.05);
  }
}

@keyframes ts-loading-slide {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(350%);
  }
}

/* Fade in animations for content */
.ts-loading-logo {
  animation: ts-pulse 2s ease-in-out infinite, ts-fade-in 0.6s ease backwards;
}

.ts-loading-title {
  animation: ts-fade-in 0.8s ease 0.2s backwards;
}

.ts-loading-subtitle {
  animation: ts-fade-in 1s ease 0.4s backwards;
}

.ts-loading-spinner {
  animation: ts-fade-in 1.2s ease 0.6s backwards;
}

@keyframes ts-fade-in {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .ts-loading-screen,
  .ts-loading-logo,
  .ts-loading-title,
  .ts-loading-subtitle,
  .ts-loading-spinner,
  .ts-spinner-bar {
    animation: none !important;
  }
  
  .ts-loading-screen {
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }
}
</style>

<script>
// Loading Screen Control Script
(function() {
  'use strict';
  
  const loadingScreen = document.getElementById('ts-loading-screen');
  if (!loadingScreen) return;
  
  // Minimum display time to prevent flash (in milliseconds)
  const MIN_DISPLAY_TIME = 800;
  const startTime = Date.now();
  
  function hideLoadingScreen() {
    const elapsed = Date.now() - startTime;
    const remainingTime = Math.max(0, MIN_DISPLAY_TIME - elapsed);
    
    setTimeout(function() {
      loadingScreen.classList.add('ts-loaded');
      // Remove from DOM after transition
      setTimeout(function() {
        loadingScreen.remove();
      }, 350); // Match transition-slow duration
    }, remainingTime);
  }
  
  // Hide loading screen when page is fully loaded
  if (document.readyState === 'complete') {
    hideLoadingScreen();
  } else {
    window.addEventListener('load', hideLoadingScreen);
  }
  
  // Fallback: hide after maximum time even if load event doesn't fire
  setTimeout(hideLoadingScreen, 5000);
})();
</script>
